File : interrupts.c

***************************Description***************************************
Interrupt signals are the distraction which diverts processor to a new activity outside from normal flow of execution. This new activity is called interrupt handler or interrupt service routine (ISR) and that distraction is Interrupts.
*********************************************************************************
**Polling** 
In polling the CPU keeps on checking all the hardwares for any request.The controller keeps monitoring the flags or signals one by one for all devices and provides service to whichever component that needs its service.
************************************************************************************
**Interrupt** 
In interrupt the CPU takes care of the hardware only when the hardware requests for some service.When the flags or signals are received, they notify the controller that they need to be serviced.
							Interrupt controller ---> Processor-->OS  	

Different devices are associated with different interrupts using a unique value associated with each interrupt. This enables the operating system to differentiate between interrupts and to know which hardware device caused which interrupt.

**Types of interrupt** 
* Maskable – All Interrupt Requests (IRQs) issued by I/O devices give rise to maskable interrupts. A maskable interrupt can be in two states: masked or unmasked; a masked interrupt is ignored by the control unit as long as it remains masked.
* Nonmaskable – Only a few critical events (such as hardware failures) give rise to nonmaskable interrupts. Nonmaskable interrupts are always recognized by the CPU.
************************************************************************************
**Exception**
Unlike interrupts, exceptions occur synchronously with respect to the processor clock; they are often called synchronous interrupts generated by processor.
**Types of exception** 
1.Falts – Like Divide by zero, Page Fault, Segmentation Fault.

2.Traps – Reported immediately following the execution of the trapping instruction. Like Breakpoints.

3.Aborts – Aborts are used to report severe errors, such as hardware failures and invalid or inconsistent values in system tables.

For a device’s each interrupt, its device driver must register an interrupt handler.
************************************************************************************

*****Interrupt handler**********
The kernel invokes them in response to interrupts and that they run in a special context called interrupt context. This special context is occasionally called atomic context because code executing in this context is unable to block.

To the hardware: the operating system services the interrupt without delay.
To the rest of the system: the interrupt handler executes in as short a period as possible.

If interrupt is doing a huge amount of work then other interrupts can be missed so interrupt is divided into two :

* Top halves:The interrupt handler is the top half. The top half will run immediately upon receipt of the interrupt and performs only the work that is time-critical, such as acknowledging receipt of the   interrupt or resetting the hardware.
* Bottom halves:A bottom half is used to process data, letting the top half to deal with new incoming interrupts. Interrupts are enabled when a bottom half runs.
There are 4 bottom half mechanisms are available in Linux:
Work-queue
Threaded IRQs
Softirqs
Tasklets
************************************************************************************
***software and hardware interrupts*****

1.software interrupt:It is considered one of the ways to communicate with the kernel or to invoke system calls, especially during error or exception handling.It has the highest priority and cannot be ignored.

2.hardware interrupt: It is considered one of the ways to communicate with the outside peripherals, hardware.PC is not increamented.It is a slow priority than software interrupt.
maskable :can be delayed 
non maskable :cannot be delayed 
************************************************************************************

**********programming********* 
1.Registering an Interrupt Handler
	
#define IRQ_NO 11
int request_irq(unsigned int irq,irqreturn_t (*handler)( ), unsigned long flags, const char *dev_name, void *dev_id);
	unsigned int irq : The interrupt number being requested.
	irqreturn_t (*handler)(int, void *, struct pt_regs *) : The pointer to the handling function being installed.
	unsigned long flags : a bit mask of options related to interrupt management.
	const char *dev_name :The string passed to request_irq is used in /proc/interrupts to show the owner of the interrupt.


2.Freeing an Interrupt Handler
	void free_irq(unsigned int irq, void *dev_id); 
           
3.Interrupt Handler
	static irqreturn_t irq_handler(int irq,void *dev_id) 

************************************************************************************ 
****Triggering Hardware Interrupt through Software****
Intel processors handle interrupt using IDT (Interrupt Descriptor Table) . The IDT consists of 256 entries with each entry corresponding to a vector and of 8 bytes. All the entries are pointer to the interrupt handling function. The CPU uses IDTR to point to IDT.
************************************************************************************
***signal handlers******
Signals are sent to the process to notify that an event has occured.It can be send among the user space or form kernel to user space.Signal handlers are the function that handles signals received by the process.  

************************************************************************************
Each interrupting device is assigned an associated identifier called an interrupt request (IRQ) number. When the processor detects that an interrupt has been generated on an IRQ, it abruptly stops what it is doing and invokes an interrupt service routine (ISR) registered for the corresponding IRQ.
************************************************************************************

Flow of interrupt routine
************************************************************************************
Steps to compile :
1.Run				make
2.Insert module			sudo insmod interrupts.ko
3.to display kernel message     dmesg
4.remove a module 		sudo rmmod interrupts
